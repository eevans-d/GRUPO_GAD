# üìã TODO - Pr√≥xima Sesi√≥n

## üî¥ Prioridad Alta (Hacer Primero)

### 1. Validaci√≥n End-to-End de Nuevos Comandos
**Estimado:** 30-45 min

- [ ] Configurar entorno de desarrollo con `make up`
- [ ] Verificar que el bot se conecta correctamente
- [ ] Probar comando `/historial` en Telegram
  - [ ] Sin argumentos (todas las tareas)
  - [ ] Con filtro `activas`
  - [ ] Con filtro `finalizadas`
  - [ ] Navegaci√≥n con botones ‚óÄÔ∏è ‚ñ∂Ô∏è
- [ ] Probar comando `/estadisticas` en Telegram
  - [ ] Verificar m√©tricas se calculan correctamente
  - [ ] Validar barras de progreso se muestran bien
  - [ ] Comprobar emojis y formato
- [ ] Documentar cualquier issue encontrado

**Criterios de √©xito:**
- ‚úÖ Ambos comandos responden sin errores
- ‚úÖ Paginaci√≥n funciona correctamente
- ‚úÖ Filtros aplican los cambios esperados
- ‚úÖ M√©tricas son precisas

---

### 2. Ejecutar Suite Completa de Tests
**Estimado:** 20-30 min

- [ ] Configurar entorno Python con dependencias
  ```bash
  # Si usas poetry
  poetry install
  poetry shell
  
  # O con pip
  pip install -r requirements.txt
  ```
- [ ] Ejecutar todos los tests
  ```bash
  make test
  # o
  python -m pytest -v
  ```
- [ ] Ejecutar tests espec√≠ficos del bot
  ```bash
  python -m pytest tests/bot/ -v
  ```
- [ ] Revisar cobertura
  ```bash
  make test-cov
  ```
- [ ] Corregir tests que fallen (si los hay)

**Criterios de √©xito:**
- ‚úÖ Todos los tests pasan
- ‚úÖ Cobertura ‚â• 80% en c√≥digo nuevo
- ‚úÖ No hay warnings cr√≠ticos

---

### 3. Revisar Logs y M√©tricas
**Estimado:** 15-20 min

- [ ] Verificar logs del bot no muestran errores
  ```bash
  docker logs -f gad_bot_dev
  ```
- [ ] Revisar logs de la API
  ```bash
  make logs-api
  ```
- [ ] Comprobar m√©tricas en `/metrics`
  ```bash
  curl http://localhost:8000/metrics
  ```
- [ ] Validar no hay memory leaks ni warnings de performance

**Criterios de √©xito:**
- ‚úÖ No hay errores en logs
- ‚úÖ M√©tricas se reportan correctamente
- ‚úÖ Performance es aceptable

---

## üü° Prioridad Media (Importante pero No Urgente)

### 4. Optimizaci√≥n de Queries del Historial
**Estimado:** 45-60 min

**Objetivo:** Mejorar performance de consultas de historial

**Tareas:**
- [ ] Analizar queries generadas por `get_user_tasks()`
- [ ] Identificar si faltan √≠ndices en DB
- [ ] Agregar √≠ndices si necesario:
  ```sql
  CREATE INDEX idx_tasks_user_id ON tasks(user_id);
  CREATE INDEX idx_tasks_estado ON tasks(estado);
  CREATE INDEX idx_tasks_created_at ON tasks(created_at);
  ```
- [ ] Ejecutar `EXPLAIN ANALYZE` en queries cr√≠ticas
- [ ] Documentar optimizaciones aplicadas

**Resultado esperado:** Queries ‚â§ 50ms para listas de hasta 1000 tareas

---

### 5. Implementar Cach√© para Estad√≠sticas
**Estimado:** 60-90 min

**Objetivo:** Reducir carga en DB para c√°lculos de estad√≠sticas

**Implementaci√≥n:**
```python
# En estadisticas.py
from redis import Redis
import json

async def _get_cached_stats(user_id: int, redis_client: Redis) -> dict | None:
    key = f"stats:user:{user_id}"
    cached = redis_client.get(key)
    if cached:
        return json.loads(cached)
    return None

async def _cache_stats(user_id: int, stats: dict, redis_client: Redis, ttl: int = 300):
    key = f"stats:user:{user_id}"
    redis_client.setex(key, ttl, json.dumps(stats))
```

**Tareas:**
- [ ] Agregar cliente Redis a estadisticas.py
- [ ] Implementar funciones de cach√©
- [ ] Actualizar handler para usar cach√©
- [ ] Invalidar cach√© cuando se crean/finalizan tareas
- [ ] Agregar tests para l√≥gica de cach√©
- [ ] Documentar TTL y estrategia de invalidaci√≥n

**Resultado esperado:** Response time ‚â§ 100ms con cach√©, mejora de ~70%

---

### 6. Tests de Integraci√≥n E2E
**Estimado:** 90-120 min

**Objetivo:** Validar flujo completo usuario ‚Üí bot ‚Üí API ‚Üí DB

**Casos de prueba:**
```python
# tests/integration/test_bot_e2e.py

@pytest.mark.integration
async def test_historial_flow_completo():
    """Test flujo completo de historial."""
    # 1. Crear tareas de prueba en DB
    # 2. Simular comando /historial desde bot
    # 3. Verificar respuesta contiene tareas
    # 4. Simular click en bot√≥n "Siguiente"
    # 5. Verificar paginaci√≥n funciona
    # 6. Cleanup

@pytest.mark.integration  
async def test_estadisticas_calculo_correcto():
    """Test c√°lculo de estad√≠sticas es preciso."""
    # 1. Crear dataset conocido en DB
    # 2. Ejecutar comando /estadisticas
    # 3. Parsear respuesta y validar n√∫meros
    # 4. Verificar c√°lculos manuales coinciden
    # 5. Cleanup
```

**Tareas:**
- [ ] Crear `tests/integration/test_bot_e2e.py`
- [ ] Implementar helpers para simular updates de Telegram
- [ ] Agregar fixtures para datos de prueba
- [ ] Ejecutar y validar tests pasan
- [ ] Documentar setup necesario para tests E2E

---

## üü¢ Prioridad Baja (Nice to Have)

### 7. Implementar Comando `/editar_tarea`
**Estimado:** 120-180 min

**Estado:** Dise√±o completo disponible en `docs/bot/FEATURES_BONUS.md`

**Pasos de implementaci√≥n:**
1. Crear `src/bot/commands/editar_tarea.py`
2. Implementar wizard de edici√≥n:
   - Listar tareas del usuario
   - Permitir seleccionar una
   - Mostrar campos editables
   - Confirmar cambios
3. Agregar validaciones de permisos
4. Implementar auditor√≠a de cambios
5. Registrar handler en `handlers/__init__.py`
6. Crear tests en `tests/bot/test_editar_tarea.py`
7. Actualizar documentaci√≥n

**Consideraciones:**
- Solo permitir editar tareas propias
- Log de cambios en tabla `task_audit`
- Validar campos antes de guardar
- Cancelar sin guardar debe ser f√°cil

---

### 8. Expandir M√©tricas del Dashboard
**Estimado:** 60-90 min

**Nuevas m√©tricas a agregar en `/estadisticas`:**

```python
# M√©tricas adicionales
- Racha actual (d√≠as consecutivos con tareas completadas)
- Mejor racha hist√≥rica
- D√≠a de la semana m√°s productivo
- Hora del d√≠a m√°s productiva
- Comparativa vs promedio de equipo
- Ranking entre usuarios (opcional)
```

**Implementaci√≥n:**
- [ ] Agregar nuevos c√°lculos en `_calculate_statistics()`
- [ ] Actualizar formato en `_format_statistics()`
- [ ] Agregar nuevos emojis y visualizaciones
- [ ] Tests para nuevas m√©tricas
- [ ] Actualizar documentaci√≥n

---

### 9. Internacionalizaci√≥n (i18n)
**Estimado:** 180-240 min

**Objetivo:** Soportar m√∫ltiples idiomas en el bot

**Implementaci√≥n:**
```python
# i18n/es.json
{
  "commands.historial.title": "üìã Historial de Tareas",
  "commands.historial.empty": "No tienes tareas {filter}",
  "commands.estadisticas.title": "üìä Mis Estad√≠sticas"
}

# i18n/en.json
{
  "commands.historial.title": "üìã Task History",
  "commands.historial.empty": "You don't have {filter} tasks",
  "commands.estadisticas.title": "üìä My Statistics"
}
```

**Tareas:**
- [ ] Crear estructura de carpetas `i18n/`
- [ ] Extraer todos los strings a archivos de traducci√≥n
- [ ] Implementar sistema de detecci√≥n de idioma
- [ ] Actualizar comandos para usar traducciones
- [ ] Agregar comando `/idioma` para cambiar idioma
- [ ] Tests para diferentes idiomas
- [ ] Documentar sistema de i18n

---

## üîÆ Backlog Futuro (Ideas para Explorar)

### Sistema de Notificaciones Proactivas
**Concepto:** Bot env√≠a notificaciones autom√°ticas

**Casos de uso:**
- Tareas pr√≥ximas a vencer (24h antes)
- Tareas vencidas sin completar
- Resumen diario/semanal autom√°tico
- Celebraci√≥n de hitos (10 tareas completadas, etc.)

**Complejidad:** Alta (requiere job scheduler)

---

### Reportes Peri√≥dicos Autom√°ticos
**Concepto:** Informes autom√°ticos por email/Telegram

**Tipos de reportes:**
- Reporte semanal personal
- Reporte mensual del equipo
- Comparativa de productividad
- Trends y an√°lisis

**Complejidad:** Media-Alta

---

### Integraci√≥n Multi-Plataforma
**Concepto:** Expandir m√°s all√° de Telegram

**Plataformas objetivo:**
- Slack
- Discord  
- Microsoft Teams
- WhatsApp Business API

**Complejidad:** Alta (cada plataforma es diferente)

---

### Dashboard Web Complementario
**Concepto:** Interfaz web responsive para m√≥vil/desktop

**Features:**
- Visualizaci√≥n de m√©tricas avanzadas
- Gr√°ficos interactivos (Chart.js)
- Gesti√≥n completa de tareas
- Reportes exportables (PDF/Excel)

**Complejidad:** Muy Alta (proyecto independiente)

---

## üìù Notas Importantes

### Antes de Empezar Ma√±ana
1. ‚òï Caf√©/t√© listo
2. üéß Playlist de concentraci√≥n preparada
3. üì± Notificaciones silenciadas
4. üìã Este TODO abierto en pantalla secundaria

### Recordatorios
- **Commits frecuentes:** Commit cada feature peque√±a completada
- **Branch por feature:** Crear branches para cambios grandes
- **Tests primero:** Red ‚Üí Green ‚Üí Refactor
- **Documentar mientras:** No dejar docs para el final

### Enlaces √ötiles
- [Documentaci√≥n Telegram Bot API](https://core.telegram.org/bots/api)
- [Python-telegram-bot v20.x Docs](https://docs.python-telegram-bot.org/)
- [FastAPI Docs](https://fastapi.tiangolo.com/)
- [Pytest Best Practices](https://docs.pytest.org/en/stable/goodpractices.html)

---

## ‚úÖ Template de Checklist de Sesi√≥n

**Al inicio de sesi√≥n:**
- [ ] Pull latest changes from master
- [ ] Verificar que tests existentes pasan
- [ ] Levantar entorno con `make up`
- [ ] Verificar servicios healthy
- [ ] Revisar issues pendientes en GitHub (si aplica)

**Durante desarrollo:**
- [ ] Commits peque√±os y frecuentes
- [ ] Tests para cada feature nueva
- [ ] Documentar funciones complejas
- [ ] Verificar que lint pasa (`make lint`)

**Al final de sesi√≥n:**
- [ ] Ejecutar suite completa de tests
- [ ] Push de todos los commits
- [ ] Actualizar este TODO con progreso
- [ ] Crear RESUMEN_JORNADA_YYYYMMDD.md
- [ ] Commit y push de documentaci√≥n

---

## üìä M√©tricas de Progreso

### Opci√≥n 7 - Features Bonus
```
Estado actual: ‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ∞‚ñ∞ 100%

‚úÖ Implementaci√≥n base     [100%]
‚úÖ Tests unitarios         [100%]
‚úÖ Documentaci√≥n           [100%]
‚úÖ Integraci√≥n handlers    [100%]
üîÑ Validaci√≥n E2E          [  0%] ‚Üê PR√ìXIMO
üîÑ Optimizaci√≥n            [  0%]
üìã Feature opcional        [  0%] (editar_tarea)
```

### Plan General (7 Opciones)
```
‚úÖ Opci√≥n 1: Testing Manual         [100%]
‚úÖ Opci√≥n 2: Merge a Master         [100%]
‚úÖ Opci√≥n 3: Revisi√≥n de C√≥digo     [100%]
‚úÖ Opci√≥n 4: Deploy a Producci√≥n    [100%]
‚úÖ Opci√≥n 5: An√°lisis y M√©tricas    [100%]
‚úÖ Opci√≥n 6: Mejorar UX             [100%]
‚úÖ Opci√≥n 7: Features Bonus         [100%]
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ TOTAL:                           [100%]
```

---

## üéØ Objetivos de la Pr√≥xima Sesi√≥n

### M√≠nimos Indispensables
1. ‚úÖ Validaci√≥n E2E funcional
2. ‚úÖ Tests pasando al 100%
3. ‚úÖ No hay errores en logs

### Ideales
4. ‚≠ê Optimizaci√≥n de queries implementada
5. ‚≠ê Cach√© de estad√≠sticas funcionando
6. ‚≠ê Tests de integraci√≥n E2E creados

### Stretch Goals (Si Hay Tiempo)
7. üåü Comando /editar_tarea implementado
8. üåü M√©tricas expandidas en dashboard
9. üåü Primera versi√≥n de i18n

---

**üöÄ ¬°Listo para continuar ma√±ana!**

*√öltima actualizaci√≥n: 11 Octubre 2025 - Post Opci√≥n 7*  
*Siguiente revisi√≥n: Inicio de pr√≥xima sesi√≥n*
